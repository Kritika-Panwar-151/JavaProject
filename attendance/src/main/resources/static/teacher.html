<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Teacher Panel</title>

<style>
*{box-sizing:border-box;font-family:"Segoe UI",Arial}
body{
    height:100vh;margin:0;
    background:linear-gradient(135deg,#FAFAFA,#FCE4EC);
    display:flex;justify-content:center;align-items:center;
}
.card{
    width:480px;background:#fff;padding:40px;border-radius:16px;
    box-shadow:0 15px 40px rgba(0,0,0,.12);
    display:flex;flex-direction:column;align-items:center;
}
h2{margin-bottom:16px}
.form{width:100%;max-width:380px}
label{font-size:13px;margin-bottom:6px;display:block}
input{
    width:100%;padding:12px 14px;border-radius:10px;
    border:1px solid #BDBDBD;margin-bottom:16px
}
button{
    width:100%;padding:14px;border:none;border-radius:12px;
    background:#C2185B;color:#fff;font-size:15px;
    cursor:pointer;margin-bottom:10px
}
.status{margin-top:8px;font-size:14px;color:#D32F2F;text-align:center}
.hidden{display:none}
.code-box{
    font-size:18px;
    font-weight:600;
    margin:10px 0;
    color:#2E7D32;
}
.back{
    margin-top:18px;
    font-size:13px;
    color:#C2185B;
    text-decoration:none;
}
.back:hover{text-decoration:underline}
</style>
</head>

<body>
<div class="card">

<!-- LOGIN -->
<div id="login">
    <h2>Teacher Login</h2>
    <div class="form">
        <label>Teacher ID</label>
        <input id="tid">
        <label>Password</label>
        <input type="password" id="pwd">
        <button onclick="login()">Login</button>
        <div class="status" id="loginStatus"></div>
    </div>
    <a class="back" href="index.html">← Back</a>
</div>

<!-- GENERATE SESSION -->
<div id="generate" class="hidden">
    <h2>Create Attendance Session</h2>
    <div class="form">
        <label>Section</label>
        <input id="section">
        <label>Subject Code</label>
        <input id="subject">
        <button onclick="generate()">Generate Class Code</button>
        <div class="status" id="genStatus"></div>
    </div>
</div>

<!-- SESSION CONTROL -->
<div id="session" class="hidden">
    <h2>Session Control</h2>
    <div class="code-box">Class Code: <span id="classCode"></span></div>

    <div class="form">
        <button onclick="start()">Start Session</button>
        <button onclick="pause()">Pause Session</button>
        <button onclick="resume()">Resume Session</button>
        <button onclick="end()">End Session</button>
    </div>

    <a class="back" href="index.html">← Back</a>
</div>

</div>

<script>
let currentClassCode="";

function login(){
    const tid=tidInput=document.getElementById("tid").value.trim();
    const pwd=document.getElementById("pwd").value.trim();
    const s=document.getElementById("loginStatus");

    if(!tid||!pwd){s.innerText="Please fill all fields";return;}

    fetch("/api/teacher/login",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({teacherId:tid,password:pwd})
    })
    .then(r=>r.json())
    .then(res=>{
        if(res.status==="SUCCESS"){
            document.getElementById("login").classList.add("hidden");
            document.getElementById("generate").classList.remove("hidden");
        }else if(res.status==="TEACHER_NOT_FOUND"){
            s.innerText="Teacher ID does not exist";
        }else{
            s.innerText="Invalid password";
        }
    });
}

function generate(){
    const sec=document.getElementById("section").value.trim();
    const sub=document.getElementById("subject").value.trim();
    const s=document.getElementById("genStatus");

    if(!sec||!sub){s.innerText="Please fill all fields";return;}

    fetch("/api/teacher/generate",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({section:sec,subjectCode:sub})
    })
    .then(r=>r.json())
    .then(res=>{
        currentClassCode=res.classCode;
        document.getElementById("classCode").innerText=currentClassCode;
        document.getElementById("generate").classList.add("hidden");
        document.getElementById("session").classList.remove("hidden");
    });
}

function start(){
    fetch(`/api/teacher/start/${currentClassCode}`,{method:"POST"});
}
function pause(){
    fetch(`/api/teacher/pause/${currentClassCode}`,{method:"POST"});
}
function resume(){
    fetch(`/api/teacher/resume/${currentClassCode}`,{method:"POST"});
}
function end(){
    if(confirm("End session permanently?")){
        fetch(`/api/teacher/end/${currentClassCode}`,{method:"POST"});
    }
}
</script>
</body>
</html>
